import random
import math

level = 1
hp = 100
hpmax = 100
dp = 10
xp = 0
xpmax = 100
diff = 20
monsterhp = 0
monsterdp = 0
just_leveled_up = True

def levelup():
    global just_leveled_up, xp, level, hpmax, dp, hp, hpmax, xpmax
    just_leveled_up = True
    xp = 0
    level += 1
    hpmax += 20
    dp += 5
    hp = hpmax
    xpmax = 50 * 2 ** level
    print("You leveled up! Your HP now is %d and your DP is %d" % (hp, dp))

def monster():
    global monsterhp, monsterdp, monsterhpmax
    monsterhp = random.randint(diff, 2*diff)
    monsterhpmax = monsterhp
    monsterdp = random.randint(diff/4, diff/2)
    
def fight():
    global monsterhp, hp, xp, xpmax
    monster()
    while monsterhp > 0 and hp > 0:
        monsterhp -= dp
        print("Hero attacks: Monster %d/%d HP" % (monsterhp, max(monsterhpmax, 0)))
        if monsterhp <= 0:
            monsterhp = 0
            xp += (monsterhp + monsterdp)
            if xp >= xpmax:
                levelup()
            diff += 4
            return True
            
        else:
            hp -= monsterdp
            print("Monster attacks: Your %d/%d HP" % (hp, max(hpmax, 0)))
        if hp <= 0:
            hp = 0
            print("Game over. Your score is:%.2f" % (level + xp/levelup))
            return False
        
        
def rest(amount):
    global hp, hpmax,  xp, xpmax
    if amount == 'short':
        if hp < hpmax:
            hp = min(hp + 0.1 * hpmax, hpmax)
            xp = max(xp - 0.1 * xpmax, 0)
        else:
            print ("Your energy is full")
    elif amount == 'long':
        if hp < hpmax:
            hp = min(hp + 0.2 * hpmax, hpmax)
            xp = max(xp - 0.2 * xpmax, 0)
        else:
            print ("Your energy is full")
    
# this function prints the menu of choices after each fight that does not lead to levelup
def menu():
    while True:
        choices = "FSLE"
        print("Please look at your options: ")
        print("[F] Fight without resting")
        print("[S] Short rest, then fight")
        print("[L] Long rest, then fight")
        print("[E] Exit")
        choice = input("-> Please enter your choice: ")
        choice = choice.upper()[0] # with this line we turn lowercase letters into uppercase
        if choice in choices:
            return choice
        print("Error: you did not give one of the choices, please try again")
    


# this function prints the menu of choices after levelup
def menu2():
    while True:
        choices = "NQ"
        print("Please choose:")
        print("[N] New Fight")
        print("[Q] Quit")
        decision = input("--> Please enter your choice: ")
        decision = decision.upper()[0]
        if decision in choices:
            return decision
        print("Error: you did not give one of the choices, please try again\n")
        

print("Let's Play! You will fight with a moster. Let's go!")
while True:
    if just_leveled_up:
        just_leveled_up = False
        decision = menu2()
        if decision == 'N':
            if not fight():
                break
        elif decision == 'Q':
            print ("your score is:%.2f" % (level + xp/levelup))
            break
    
    else:
        choice = menu()
        if choice == 'F':
            if not fight():
                break
        elif choice == 'S':
            rest("short")
        elif choice == 'L':
            rest("long")
        elif choice == 'E':
            print("your score is: %.2f" % (level + xp/levelup))
            break
    
