#include <stdio.h>
#include <stdlib.h>
#include <math.h>

char menu()
{
    char choices[5] = "FSLE";
    char choice;
    char buffer[80];
    printf("Please choose: \n");
    printf("[F] Fight without resting\n");
    printf("[S] Short rest, then fight\n");
    printf("[L] Long rest, then fight\n");
    printf("[E] Exit\n");
    printf("--> Please enter your choice: ");
    scanf("%s", buffer);
    choice=buffer[0];
    if (choice>='a' && choice<='z')
        choice = choice - 'a' + 'A';
    for (int i=0; i<5; i++)
        if (choice==choices[i])
            return choice;
    printf("Error: you did not give one of the choices, please try again\n\n");
    return menu();
}

char menu2()
{
    char choices[3] = "NQ";
    char choice;
    char buffer[80];
    printf("Please choose: \n");
    printf("[N] New Fight \n");
    printf("[Q] Quit \n");
    printf("--> Please enter your choice: ");
    scanf("%s", buffer);
    choice=buffer[0];
    if (choice>='a' && choice<='z')
        choice = choice - 'a' + 'A';
    for (int i=0; i<5; i++)
        if (choice==choices[i])
            return choice;
    printf("Error: you did not give one of the choices, please try again\n\n");
    return menu2();
}

int main()
{
    int level = 1;
    int levelup = 50 * 2^level;
    int XP[100];
    int hp;
    int dp;
    int xp;
    if (level == 1)
    {
        hp = 100;
        dp = 10;
        xp = 0;
        int diff = 20;
        printf("let's play! Fight 1\n");



        while (level>=1)
        {
            int monsterhp = diff + rand() % 2*diff;
            int monsterdp = diff/4 + rand() % diff/2;
            xp = monsterhp + monsterdp;
            for (int i=0; i<=XP[100], i++;)
            {
                xp += XP[i];
            }
            while (xp>=0)
            {
                if (monsterhp > 0 && hp > 0)
                {
                    monsterhp -= dp;
                    hp -= monsterdp;
                    printf("monster hp and dp is: %d %d and your hp is: %d, diff, %d\n", monsterhp, monsterdp, hp, diff);
                }
                if (monsterhp <= 0 && hp > 0)
                {
                    diff += 4;
                    XP[0]+=xp;
                    if (xp >= levelup)
                    {
                        level +=1;
                        printf("level is: %d\n", level);
                        char choice = menu2();
                        if (choice == 'N')
                        {
                            return main();
                        }
                        else if (choice == 'Q')
                        {
                            int score = level + xp/(levelup-xp);
                            printf("your score is: %d\n",score);
                            break;
                        }
                    }
                    printf("good job, you won! Your xp increased at %d %d\n", xp, level);
                    break;
                }
                else if (hp <= 0)
                {
                    int score = level + xp/(levelup-xp);
                    printf("game over %d%d\n", score, level);
                    break;
                    return 0;
                }
            }
            char choice = menu();
            if (choice == 'F')
            {
                continue;
            }
            else if (choice == 'S')
            {
                if (hp < 100)
                {
                    hp += 0.1*hp;
                    xp -= 0.1*xp;
                }
                else
                {
                    printf("your energy is full\n");
                }
            }
            else if (choice == 'L')
            {
                if (hp < 100)
                {
                    hp += 0.2*hp;
                    xp -= 0.2*xp;
                }
                else
                {
                    printf("your energy is full\n");
                }
            }
            else if (choice == 'E')
            {
                int score = level + xp/(levelup-xp);
                printf("%d", score);
                break;
            }
        }
    }
    else if (level > 1)
    {
        while (1)
        {
            hp = hp+20;
            dp = dp+5;
        }
    }


    return(main());

    return 0;
}
