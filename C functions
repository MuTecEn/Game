#include <stdio.h>
#include <stdlib.h>
#include <time.h>

int level = 1;
int hp = 100;
int hpmax = 100;
int dp = 10;
int xp = 0;
int xpmax = 100;
int diff = 20;
int monsterhp = 0;
int monsterdp = 0;
int just_leveled_up = TRUE;

void levelup()
{
    global just_leveled_up, xp, level, hpmax, dp, hp, hpmax, xpmax;
    just_leveled_up = True;
    xp = 0;
    level += 1;
    hpmax += 20;
    dp += 5;
    hp = hpmax;
    xpmax = 50 * 2 ** level;
    printf("You leveled up! Your HP now is %d and your DP is %d", hp, dp);
}

void monster()
{
    global monsterhp, monsterdp, monsterhpmax;
    monsterhp = diff + rand() % 2*diff;
    monsterhpmax = monsterhp;
    monsterdp = diff/4 + rand() % diff/2;
}
    
void fight()
{
    global monsterhp, hp, xp, xpmax, diff;
    monster();
    while (monsterhp > 0) && (hp > 0)
    {
        monsterhp -= dp;
        printf("Hero attacks: Monster %d/%d HP", (max(0, monsterhp), monsterhpmax));
        if (monsterhp <= 0)
        {
            monsterhp = 0;
            xp += (monsterhp + monsterdp);
            if (xp >= xpmax)
            {
                levelup();
            }
            diff += 4;
            return TRUE;
        }
        else
        {
            hp -= monsterdp;
            printf("Monster attacks: Your %d/%d HP", (max(0, hp), hpmax));
        }
        if (hp <= 0)
        {
            hp = 0;
            printf("Game over. Your score is:%.2f", (level + xp/xpmax));
            return FALSE;
        }
    }
}
        
        
void rest(char amount;)
{
    global hp, hpmax,  xp, xpmax;
    if (amount == 'short')
    {
        if (hp < hpmax)
        {
            hp = min(hp + 0.1 * hpmax, hpmax);
            xp = max(xp - 0.1 * xpmax, 0);
        }
        else
        {
            printf("Your energy is full");
        }
    }
    else if (amount == 'long')
    {
        if (hp < hpmax)
        {
            hp = min(hp + 0.2 * hpmax, hpmax);
            xp = max(xp - 0.2 * xpmax, 0);
        }
        else
        {
            printf("Your energy is full");
        }
    }
}
